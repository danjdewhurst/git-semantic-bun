# v0.3.0 Plan

Target: improve practical retrieval quality, repository ergonomics, and large-repo performance.

## Scope summary

- Better indexing control (`include/exclude` patterns)
- Better ranking and snippet quality
- Better performance and benchmark tracking
- Better operator experience (`doctor --fix`)

## Priority roadmap

## P0 — Must ship

### 1) Path include/exclude patterns

**Goal:** index only useful files/commits in real repos.

**Deliverables**
- `gsb index --include <glob>` (repeatable)
- `gsb index --exclude <glob>` (repeatable)
- `.gsbignore` support (gitignore-style best effort)
- Same controls available in `gsb update`

**Acceptance criteria**
- Indexing can skip `vendor`, `node_modules`, `dist`, lock/build artefacts
- Patterns are applied consistently in index + update flows
- Tests cover include-only, exclude-only, mixed precedence

**Estimate:** M

---

### 2) Ranking quality upgrade (BM25-lite)

**Goal:** improve exact-token relevance without losing semantic wins.

**Deliverables**
- Replace lexical overlap heuristic with BM25-lite scoring
- Keep weighted hybrid scoring (`semantic + lexical + recency`)
- Add repo-level weight presets config (`.git/semantic-index/config.json`)

**Acceptance criteria**
- Golden ranking fixtures expanded and passing
- Query classes (bugfix, refactor, file-specific) show expected ordering
- `--explain` includes BM25 contribution

**Estimate:** M

---

### 3) Snippet quality improvements

**Goal:** make search output directly usable in triage/debugging.

**Deliverables**
- `--snippet-lines <n>` (default 12)
- Snippets include file/hunk headers where possible
- Markdown output wraps snippets in `diff` fences

**Acceptance criteria**
- Snippets remain compact and readable
- No regressions in text/json outputs
- Tests for snippet extraction edge cases

**Estimate:** S

## P1 — Strongly recommended

### 4) Compact index enhancement (f16 option)

**Goal:** reduce storage and load overhead in larger repos.

**Deliverables**
- Optional vector precision mode (`f32` default, `f16` optional)
- Metadata records dtype and migration compatibility

**Acceptance criteria**
- `gsb stats` shows dtype and size impact
- Search quality regression bounded (documented)
- Legacy indexes still load

**Estimate:** M

---

### 5) Benchmark history tracking

**Goal:** make performance regressions visible over time.

**Deliverables**
- `gsb benchmark --save`
- Append records to `.git/semantic-index/benchmarks.jsonl`
- `gsb benchmark --history` summary mode

**Acceptance criteria**
- Can compare latest run vs previous baseline
- CI/perf smoke can assert upper bounds on slowdown

**Estimate:** S

---

### 6) `doctor --fix`

**Goal:** reduce support/debug friction.

**Deliverables**
- Auto-create missing index/cache directories
- Explain and optionally repair common metadata/index inconsistencies
- Non-destructive by default; explicit actions only under `--fix`

**Acceptance criteria**
- Doctor output clearly states fixed vs detected-only issues
- Safe defaults preserved
- Tests cover dry-run and fix modes

**Estimate:** S

## P2 — Nice follow-ons (stretch)

- `--query-file` support for long natural-language queries
- Default quality thresholds by output mode (`text`, `markdown`, `json`)
- Memory-mapped vector loading for very large indexes

## Release gating checklist

Before cutting `v0.3.0`:
- [ ] CI green on main
- [ ] Golden ranking fixtures updated
- [ ] Performance smoke thresholds passing
- [ ] README + command docs updated for new flags
- [ ] Migration notes included in release notes

## Suggested implementation order

1. Include/exclude patterns
2. BM25-lite lexical scorer + fixtures
3. Snippet improvements
4. Benchmark history tracking
5. `doctor --fix`
6. f16 compact vectors
